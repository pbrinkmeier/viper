\documentclass[parskip=full,11pt,twoside]{scrartcl}
\usepackage[utf8]{inputenc}

\title{VIPER Interactive Prolog Education Runtime}
\subtitle{Implementierungsbericht}
\author{Paul Brinkmeier, Lukas Brocke, Jannik Koch, Aaron Maier, Christian Oder}

% section numbers in margins:
\renewcommand\sectionlinesformat[4]{\makebox[0pt][r]{#3}#4}

% header & footer
\usepackage{scrlayer-scrpage}
\lofoot{\today}
\refoot{\today}
\pagestyle{scrheadings}

\usepackage{amsmath} % for $\text{}$

\usepackage[sfdefault,light]{roboto}
\usepackage[T1]{fontenc}
\usepackage[german]{babel}
\usepackage[yyyymmdd]{datetime} % must be after babel
\renewcommand{\dateseparator}{-} % ISO8601 date format
\usepackage{hyperref}
\usepackage[nameinlink]{cleveref}
\crefname{figure}{Abb}{Abb}
\usepackage[section]{placeins}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{courier}
\usepackage{enumitem}
\usepackage{dirtree}
\usepackage{pgfplots}
\usepackage{pgfgantt}
\usepackage{multicol}
\hypersetup{
	pdftitle={Implementierungsbericht},
}

\usepackage{csquotes}

\newcommand\urlpart[2]{$\underbrace{\text{\texttt{#1}}}_{\text{#2}}$}

\lstset{basicstyle=\ttfamily,breaklines=true}

% Don't strech across whole page
\raggedbottom

% Start new page with each section
\usepackage{sectsty}
\sectionfont{\clearpage}

\begin{document}
\pagenumbering{roman}
\maketitle
\tableofcontents

\section{Einleitung}
\pagenumbering{arabic}
\setcounter{page}{1}

% Anschluss an Entwurfsdokument
Bei VIPER handelt es sich um ein grafisches Tool zur Unterstützung des Lernens und Lehrens der logischen Programmiersprache Prolog. Hierbei soll der Nutzer die Interpretation von Prolog-Abfragen nachvollziehen können. Dies wird durch die Visualisierung des Interpretationsvorgangs als Baumstruktur erreicht. Der integrierte Editor ermöglicht weiterhin das Schreiben von Prolog-Quelltext. Abfragen zur Interpretation können über ein Textfeld gestellt werden, Informationen an den Nutzer wie das Finden einer Lösung werden über ein Ausgabefeld dargestellt.

Die Entwicklung von VIPER erfolgt in der Programmiersprache Java anhand des Model-View-Controller-Architekturstils. Hiernach wird die grafische Darstellungs-Komponente (View) von internen Datenstrukturen und deren Logik (Model) getrennt. Die Vermittlung zwischen diesen Komponenten erfolgt über den Controller. Die grafische View-Komponente ist hierbei für Desktop-Nutzung ausgelegt und mit Swing implementiert. Die Generierung der Visualisierung erfolgt mit Graphviz über die Graphviz-Java Implementierung, das Darstellen der erzeugten Visualisierung nutzt die Apache Batik Bibliothek.

\section{Änderungen zum Entwurf und Pflichtenheft}

\section{Fortschritt der Implementierung}

% Muss-Kriterien alle drin?
% Welche Kann-Kriterien?

\section{Implementierungsplan}

\begin{ganttchart}[x unit = 1.5cm]{0}{4}
	\gantttitle{Implementierungsplan (Schritte in Wochen)}{5}\\
	\gantttitlelist{0,..., 4}{1}\\
	%%%%%%%% Woche 1
	\ganttbar{Setup}{0}{0}\\
	\ganttbar{Kommando-Teilmenge A}{1}{1}\\
	\ganttbar{View-Teilmenge A}{1}{1}\\
	\ganttbar{AST-Teilmenge A}{1}{1}\\
		
	\ganttmilestone{Meilenstein: Abschluss erste Woche}{1}\\
	%%%%%%%% Woche 2 / 3
	\ganttbar{Kommando-Teilmenge B}{2}{2}\\
	\ganttbar{View-Teilmenge B}{2}{2}\\
	\ganttbar{AST-Teilmenge B}{2}{2}\\
	\ganttbar{Interpreter-Teilmenge A}{2}{2}\\
	\ganttbar{Manager-Klassen}{2}{2}\\
	\ganttbar{Controller-Tests}{2}{2}\\
	
	\ganttmilestone{Meilenstein: Abschluss zweite Woche}{2}\\
	%%%%%%%% Woche 3
	\ganttbar{Controller-Tests}{3}{3}\\
	\ganttbar{Interpreter-Teilmenge B}{3}{3}\\
	\ganttbar{Kann-Kriterien}{3}{3}\\

	\ganttmilestone{Meilenstein: Abschluss dritte Woche}{3}\ganttnewline
	%%%%%%%% Woche 4
	\ganttbar{Puffer}{4}{4}\\
	%%%%%%%% Links
	\ganttlink[link mid=0.5]{elem0}{elem1}
	\ganttlink[link mid=0.25]{elem0}{elem2}
	\ganttlink[link mid=0.17]{elem0}{elem3}
	
	\ganttlink[link mid=0.9]{elem1}{elem4}
	\ganttlink[link mid=0.85]{elem2}{elem4}
	\ganttlink[link mid=0.7]{elem3}{elem4}
	
	\ganttlink[link mid=0.5]{elem4}{elem5}
	\ganttlink[link mid=0.25]{elem4}{elem6}
	\ganttlink[link mid=0.17]{elem4}{elem7}
	\ganttlink[link mid=0.125]{elem4}{elem8}
	\ganttlink[link mid=0.1]{elem4}{elem9}
	\ganttlink[link mid=0.085]{elem4}{elem10}
	
	\ganttlink[link bulge=1.0, link mid=0.92]{elem5}{elem11}
	\ganttlink[link bulge=1.0, link mid=0.9]{elem6}{elem11}
	\ganttlink[link bulge=1.0, link mid=0.88]{elem7}{elem11}
	\ganttlink[link bulge=1.0, link mid=0.84]{elem8}{elem11}
	\ganttlink[link bulge=1.0, link mid=0.75]{elem9}{elem11}
	\ganttlink[link bulge=1.0, link mid=0.51]{elem10}{elem11}
	
	\ganttlink[link bulge=0.6, link mid=0.55]{elem11}{elem12}
	\ganttlink[link bulge=0.6, link mid=0.27]{elem11}{elem13}
	\ganttlink[link bulge=0.6, link mid=0.18]{elem11}{elem14}
	
	\ganttlink[link bulge=0.2, link mid=0.83]{elem12}{elem15}
	\ganttlink[link bulge=0.2, link mid=0.75]{elem13}{elem15}
	\ganttlink[link bulge=0.2, link mid=0.5]{elem14}{elem15}
	\ganttlink[link bulge=0.2, link mid=0.5]{elem15}{elem16}
\end{ganttchart}
\newpage
Der Implementierungsstil teilt sich in wöchentliche Aufgabenbereiche ein. Hierbei werden die Komponenten der Software soweit wie möglich separat entwickelt, ein Mergen in den Master-Branch findet halbwöchentlich und bei dringendem Bedarf statt. Die Unterteilung der Aufgabenbereiche orientiert sich grob an der Paketstruktur und unterteilt diese ggf. bei größeren Aufgabenfeldern wie dem Interpreter-Manager. Dokumentation in Form von JavaDoc wird parallel zur Entwicklung geschrieben. Dies gilt analog für die Tests des Models, da dieses frühzeitig getestet werden muss. Aufgrund der Abhängigkeiten zum Rest der Software werden Tests für die View- und Controller-Komponente nicht parallel sondern im Nachhinein entwickelt.

Das Gantt-Diagramm entspricht dem Zeitplan in Wocheneinheiten. Woche 0. entspricht hierbei dem Vorgehen am ersten Tag der ersten Woche. Die zugehörigen Aufgaben setzen sich wie folgt zusammen:
\begin{enumerate}
	\item \textbf{Setup}: Generierung des Code-Gerüsts aus dem UML-Klassendiagramm des Entwurfs, Aufsetzen des Build-Systems (Gradle) sowie des Code-Stil-Prüfers (Checkstyle). Dieser Punkt baut eine gemeinsame Grundlage auf, von der aus die einzelnen Aufgabenbereiche in separaten Branches weiterarbeiten können.
	
	\item \textbf{Kommando-Teilmenge A}: Implementierung simpler Kommandos mit wenigen bis keinen Abhängigkeiten zum Rest des Codes. Dies umfasst in erster Linie Eingabe-/Ausgabe-Kommandos sowie Kommandos, welche an den Interpreter-Manager und Sprach-Manager des Controller-Pakets delegieren, namentlich:
	\begin{multicols}{3}
		\begin{itemize}
			\item CommandNew
			\item CommandOpen
			\item CommandSave
			\item CommandZoom

			\item CommandToggleLib
			\item CommandSetLang
			\item CommandExportTikZ
			\item CommandExportImage

			\item CommandParse
			\item CommandExit
		\end{itemize}
	\end{multicols}

	\item \textbf{View-Teilmenge A}: Implementierung der wichtigsten GUI-Komponenten. Hierzu gehört das Hauptfenster, der Editor sowie Menü- und Werkzeugleiste.
	
	\item \textbf{AST-Teilmenge A}: Implementierung und Testen von der Term-Klasse und ihren Subklassen.
	
	\item \textbf{Meilenstein: Abschluss erste Woche}: Das Projekt ist aufgesetzt. Beim Ausführen wird die GUI erfolgreich angezeigt, ein Editor ist vorhanden, Texteingaben sind möglich. Simple Dateioperationen wie Öffnen und Speichern funktionieren. Der grundlegende Term-Baustein des Models ist implementiert und getestet.

	\item \textbf{Kommando-Teilmenge B}: Implementierung komplexerer Kommandos mit diversen Abhängigkeiten zum Rest des Codes. Dies umfasst in erster Linie Kommandos, welche die Interpretation steuern. Weiter werden Kommandos fertig implementiert, die stärkere Abhängigkeiten zum Rest des Codes haben wie die Export-Funktionen:
	\begin{multicols}{3}
		\begin{itemize}
			\item CommandNextStep
			\item CommandPreviousStep
			\item CommandContinue
			\item CommandCancel
			
			\item CommandExportTikZ
			\item CommandExportImage
			\item CommandFormat
		\end{itemize}
	\end{multicols}

	\item \textbf{View-Teilmenge B}: Implementierung des Konsolen-Bereichs, des Visualisierungs-Bereichs sowie erster Tests. Weiter werden erste Icons für die Schaltflächen erstellt.

	\item \textbf{AST-Teilmenge B}: Implementierung der KnowledgeBase, Ziele und Regeln sowie Einfügen und Anpassen des gegebenen Parsers. Hierzu gehört ebenfalls das parallele Entwickeln von Unit-Tests.
	
	\item \textbf{Interpreter-Teilmenge A}: Implementierung des ActivationRecords sowie des spezifischen FunctorActivationRecords, der Visitor-Klassen sowie der Unifikations-Klassen. Hierzu gehört ebenfalls das parallele Entwickeln von Unit-Tests.
	
	\item \textbf{Manager-Klassen}: Implementierung der Manager-Klassen des Controllers, namentlich dem Sprach-Manager und dem Interpreter-Manager.
	
	\item \textbf{Controller-Tests}: Implementierung der Tests für das Controller-Paket. Dies beginnt in der zweiten Woche parallel zur Fertigstellung des Controllers und endet mit der dritten Woche.
	
	\item \textbf{Meilenstein: Abschluss zweite Woche}: Die Controller-Komponente ist vollständig implementiert und zu Teilen getestet. Die grafische Benutzeroberfläche ist ebenfalls vollständig und an die Kommandos angebunden. Das Parsen von Quellcode und das Parsen sowie Interpretieren von simplen Abfragen (ohne Nutzung von Features der Kann-Kriterien) ist möglich.
	
	\item \textbf{Interpreter-Teilmenge B}: Implementierung und Testen der Visualisierungs-Klassen des Models.
	
	\item \textbf{Kann-Kriterien}: Implementierung und Testen einer Teilmenge der im Pflichtenheft beschriebenen Kann-Kriterien, dazu gehören:
	\begin{multicols}{2}
		\begin{itemize}
			\item Zurückschreiten
			\item Arithmetik
			\item Cut
			\item Ausführung bis zur nächsten Lösung
			\item Unterstützung einer Standardbibliothek
			\item Export als TikZ-Code für LaTeX
			\item Export als Bild-Datei (PNG, SVG)
			\item Pretty-Printing für Listen
		\end{itemize}
	\end{multicols}
	
	\item \textbf{Meilenstein: Abschluss dritte Woche}: Die Controller-Komponente ist vollständig getestet. Die Visualisierung bei der Interpretation ist verfügbar und wird korrekt angezeigt. Eine Teilmenge der Kann-Kriterien des Pflichtenhefts wurde erfolgreich implementiert und getestet.
	
	\item \textbf{Puffer}: Puffer-Woche für finales Testen und Reparatur von entstandenen Bugs.
\end{enumerate}

% Abweichungen?

\section{Unit-Tests}

\subsection{Übersicht}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Paket:			& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
		Gesamt:			& 84 	& 79 & 0 & 5\\
		\hline
		Controller: 	& 21	& 19 & 0 & 2\\
		View:			& 0		& 0 & 0 & 0\\
		Parser:			& 2		& 2 & 0 & 0\\
		AST:			& 37	& 34 & 0 & 3\\
		Interpreter:	& 23	& 23 & 0 & 0\\
		Visualisation:	& 1		& 1 & 0 & 0\\
		\hline
	\end{tabular}
\end{figure}

\subsubsection{Unit-Tests: Controller}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Klasse:			& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
		CommandExportImageTest 	& 2 & 0 & 0 & 2\\
		CommandFormatTest		& 1 & 1 & 0 & 0\\
		CommandNewTest			& 1 & 1 & 0 & 0\\
		CommandOpenTest			& 3 & 3 & 0 & 0\\
		CommandParseTest		& 3 & 3 & 0 & 0\\
		CommandSaveTest			& 4 & 4 & 0 & 0\\
		CommandSetLangTest		& 1 & 1 & 0 & 0\\
		CommandToggleLibTest	& 1 & 1 & 0 & 0\\
		FileFiltersTest			& 4 & 4 & 0 & 0\\
		FileUtilitiesTest		& 1 & 1 & 0 & 0\\
		\hline
	\end{tabular}
\end{figure}

\subsubsection{Unit-Tests: View}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Klasse:		& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
	\end{tabular}
\end{figure}

\subsubsection{Unit-Tests: Parser}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Klasse:		& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
		ParserTest 	& 2 & 2 & 0 & 0\\
		\hline
	\end{tabular}
\end{figure}

\subsubsection{Unit-Tests: AST}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Klasse:						& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
		AdditionOperationTest 		& 2 & 2 & 0 & 0\\		
		BinaryOperationTest 		& 5 & 4 & 0 & 1\\
		FunctorGoalTest 			& 2 & 2 & 0 & 0\\
		FunctorTest 				& 9 & 8 & 0 & 1\\		
		MultiplicationOperationTest & 2 & 2 & 0 & 0\\
		NumberTest 					& 5 & 5 & 0 & 0\\
		RuleTest 					& 3 & 3 & 0 & 0\\		
		SubtractionOperationTest 	& 2 & 2 & 0 & 0\\
		TermTest 					& 1 & 1 & 0 & 0\\
		VariableTest 				& 6 & 5 & 0 & 1\\
		\hline
	\end{tabular}
\end{figure}

\subsubsection{Unit-Tests: Interpreter}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Klasse:						& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
		IndexifierTest 			& 3 & 3 & 0 & 0\\		
		InterpreterTest 		& 1 & 1 & 0 & 0\\
		SubstitutionTest 		& 3 & 3 & 0 & 0\\
		UnificationResultTest 	& 7 & 7 & 0 & 0\\		
		UnificationTest 		& 8 & 8 & 0 & 0\\
		VariableExtractorTest 	& 1 & 1 & 0 & 0\\
		\hline
	\end{tabular}
\end{figure}

\subsubsection{Unit-Tests: Visualisation}
\begin{figure}[!h]
	\centering
	\begin{tabular}{l | c | c | c | c}
		\hline
		Klasse:				& Testzahl & Erfüllt & Fehlschlagend & Ignoriert \\
		\hline
		GraphvizMakerTest 	& 1 & 1 & 0 & 0\\
		\hline
	\end{tabular}
\end{figure}

\newpage
\subsection{Abdeckung}
\begin{figure}[!h]
\centering
\hspace*{-1cm}
\begin{tikzpicture}[scale=1.2]
	\begin{axis}[
		xbar, 
		y=-0.5cm,
		bar width=0.3cm,
		xmin = 0,
		xmax = 100,
		enlarge y limits={abs=0.45cm},
		xlabel={Gesamtabdeckung in Prozent},
		symbolic y coords={
			Instruktions-Abdeckung,
			Branch-Abdeckung
		},
		ytick=data,
		nodes near coords, nodes near coords align={horizontal},
		]
		\addplot table[col sep=comma,header=false] {
			77, Instruktions-Abdeckung
			60, Branch-Abdeckung
		};
	\end{axis}
\end{tikzpicture}\\\vspace*{1cm}\hspace*{1cm}
\begin{tikzpicture}[scale=1.2]
	\begin{axis}[
		xbar, 
		y=-0.5cm,
		bar width=0.3cm,
		xmin = 0,
		enlarge y limits={abs=0.45cm},
		xlabel={Abgedeckte Instruktionen in Prozent},
		symbolic y coords={
			Controller,
			View,
			Parser,
			AST,
			Interpreter,
			Visualisation
	    },
		ytick=data,
		nodes near coords, nodes near coords align={horizontal},
		]
		\addplot table[col sep=comma,header=false] {
			65, Controller
			77, View
			70, Parser
			92, AST
			95, Interpreter
			98, Visualisation
		};
	\end{axis}
\end{tikzpicture}\\\vspace*{1cm}\hspace{1cm}
\begin{tikzpicture}[scale=1.2]
	\begin{axis}[
		xbar, 
		y=-0.5cm,
		bar width=0.3cm,
		xmin = 0,
		enlarge y limits={abs=0.45cm},
		xlabel={Abgedeckte Branches in Prozent},
		symbolic y coords={
			Controller,
			View,
			Parser,
			AST,
			Interpreter,
			Visualisation,
		},
		ytick=data,
		nodes near coords, nodes near coords align={horizontal},
		]
		\addplot table[col sep=comma,header=false] {
			33, Controller
			24, View
			59, Parser
			75, AST
			92, Interpreter
			83, Visualisation
		};
		\end{axis}
	\end{tikzpicture}
\end{figure}


\section{Statistiken}

% Commits, LoC, JavaDoc, ...
\subsection{Commits}
\begin{figure}[!h]
	\centering
	%% Merge-Commits sind abgezählt, Rest via git rev-list <HASH> --count
	Zahl der Commits nach Abschluss der Entwurfsphase (25. Juni 2018): 344\\\vspace*{0.3cm}
	\begin{tabular}{l | c | c | c | c}
		\hline
		Datum des Abrufs:	& 2. Juli 2018 & 9. Juli 2018 & 16. Juli 2018 & 23. Juli 2018\\
		\hline
		Commit-Zahl insgesamt:		& 408 & 538 & TODO & TODO \\
		Differenz zur vorigen Woche:	& 64 & 130 & TODO & TODO \\
		Differenz zum Phasenbeginn: & 64 & 194 & TODO & TODO \\
		Merge-Commits in Woche: & 10 & 14 & 16 & TODO \\
		\hline
	\end{tabular}
\end{figure}
\vspace*{1cm}
\begin{minipage}{0.5\textwidth}
		\centering
		Commits pro Woche:\\
		\begin{tikzpicture}[scale=0.9]
		\begin{axis}[
		symbolic x coords = {1. Woche, 2. Woche, 3. Woche, 4. Woche}, xtick = data]
		
		\addplot[ybar, fill = blue] coordinates {
			(1. Woche, 64)
			(2. Woche, 194)
			(3. Woche, 0)
			(4. Woche, 0)
		};
		\end{axis}
		\end{tikzpicture}
\end{minipage}\hspace*{0.7cm}
\begin{minipage}{0.5\textwidth}
		\centering
		Merge-Commits pro Woche:\\
		\begin{tikzpicture}[scale=0.9]
		\begin{axis}[
		symbolic x coords = {1. Woche, 2. Woche, 3. Woche, 4. Woche}, xtick = data]
		
		\addplot[ybar, fill = blue] coordinates {
			(1. Woche, 10)
			(2. Woche, 14)
			(3. Woche, 16)
			(4. Woche, 0)
		};
		\end{axis}
		\end{tikzpicture}
\end{minipage}

\subsection{Codebase}
\begin{figure}[!h]
	\centering
	\begin{tabular}{c | c | c | c | c}
		\hline
		%%% Berechnet via CLOC
		Sprache & Dateien & Leerzeilen & Kommentare & Code\\
		\hline
		Java & 123 & 1327 & 3139 & 4761\\
		\hline
	\end{tabular}
\end{figure}


\end{document}
